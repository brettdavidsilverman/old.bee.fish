<!DOCTYPE html>
<html lang="en">
   <head>
      <script src="/head.js"></script>
      <meta charset="utf-8"/>
      <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0"/>
<!--
      <link rel="stylesheet" type="text/css" href="/style.css" />
-->
      <link rel="stylesheet" type="text/css" href="style.css" />

      <title>Bee Hive</title>
      <script src="../client/fetch.js"></script>
      <script src="../client/logon/authentication.js"></script>
      <script src="../client/id/id.js"></script>
      <script src="../client/storage/storage.js"></script>
<!--
      <script src="../client/stream/stream.js"></script>
      <script src="../client/power-encoding/power-encoding.js"></script>
      <script src="../cllient/pointer/pointer.js"></script>
      <script src="../client/console/console.js"></script>
-->
      <style>
.number {
   width:50px;
   text-align:right;
}

#beehiveURL {
   color:red;
}
      </style>
   </head>
   <body>
      <script src="/body.js"></script>
      <h1>Bee Hive</h1>

      <h2>Your Bee Hives</h2>
      <a id="beehiveURL" style="display:none;">Bee Hive #1</a>
      <form onchange="saveSettings()" style="display:none;" id="form">
         Wake up next time <input type="checkbox" id="wakeup"></input>
         and check every <input type="number" value="60" id="checkEvery" class="number"></input> seconds
         <br/>
         Photograph every <input type="number" value="30" id="photographMinutes" class="number"></input> minutes
         <script>
var form = document.getElementById("form");
var storage = new RemoteStorage({url:  document.location.origin + "/beehive/"});
var settings;

var beehiveURL = document.getElementById("beehiveURL");
var wakeup = document.getElementById("wakeup");
var checkEvery = document.getElementById("checkEvery");
var photographMinutes = document.getElementById("photographMinutes");

function getSettings() {

   storage.getItem("settings")
      .then(
         function(value) {
            if (value == null) {
               beehiveURL.style.display = "none";
               form.style.display = "none";
            }
            else {
               settings = JSON.parse(value);
               beehiveURL.href = settings.url;
               beehiveURL.innerHTML = "";
               var text = document.createTextNode(settings.label);
               beehiveURL.appendChild(text);
               beehiveURL.style.display = "inline";
               wakeup.checked = settings.wakeup;
               checkEvery.value = settings.checkEvery;
               photographMinutes.value = settings.photographMinutes;

               form.style.display = "block";
            }
         }
      ).catch(
         function(error) {
            alert(error);
         }
      );
}

function saveSettings() {
   settings["wakeup"] = wakeup.checked;
   settings["checkEvery"] = Number(checkEvery.value);
   settings["photographMinutes"] = Number(photographMinutes.value);
   var string = JSON.stringify(settings);
   storage.setItem("settings", string);
}  

         </script>
      </form>
      <script>

window.onload = function() {
   getSettings();
}

      </script>

   </body>
</html>