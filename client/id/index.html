<!DOCTYPE html>
<html lang="en">
   <head>
      <script src="/head.js"></script>
      <meta charset="utf-8"/>
      <meta name="viewport" content="width=device-width, initial-scale=1"/>
      <script src="../stream/stream.js"></script>
      <script src="../power-encoding/power-encoding.js"></script>
      <script src="../storage/storage.js"></script>
      <script src="id.js"></script>
      <link rel="stylesheet" type="text/css" href="/style.css" />
      <link rel="stylesheet" type="text/css" href="../style.css" />

      <title>Id</title>
   </head>
   <body>
      <script src="/body.js"></script>
      <h1>Id</h1>
      <a href="id.js">id.js</a>
      
      <h2>Usage</h2>
      <p>Create a new Id and write out its milliseconds
      in milliseconds and increment, and its key.</p>
      <pre>
         <script>
// Create the Id
var id = new Id();

// Write out its default string
document.writeln(id);

// Write out its string encoded key
document.writeln(id.key);

// Create a new id from old key
var id2 = Id.fromKey(id.key);

         </script>
      </pre>

      <h2>Id Form</h2>
      <form>
         <button onclick="createId()" type="button">New</button>
         <br />
         Key
         <br />
         <textarea id="key" rows="3" cols="40"></textarea>
         <br />
         <button onclick="loadData()" type="button">Ok</button>
         <br />
         Name
         <br />
         <input type="text" id="name"></input>
         <br />
         Milliseconds
         <br />
         <input type="text" id="milliseconds"></input>
         <br />
         Increment
         <br />
         <input type="text" id="increment"></input>
         <br />
         <button onclick="loadKey()" type="button">Ok</button>
         <script style="display:none;">
function loadKey()
{
   var name =
      document.getElementById("name").value;
   var milliseconds =
      document.getElementById("milliseconds").value;
   var increment =
      document.getElementById("increment").value;

   var data =
   {
      name: name,
      ms: Number(milliseconds),
      inc: Number(increment)
   }
   
   id = new Id(data);
      
   document.getElementById("key").value =
      id.key;
}

function loadData()
{
   var key =
      document.getElementById("key").value;
   
   id = new Id({key});
   
   document.getElementById("name").value =
      id.name;
      
   document.getElementById("milliseconds").value =
      id.ms;
      
   document.getElementById("increment").value =
      id.inc;
      
   
}

function createId()
{
   id = new Id();

   document.getElementById("key").value =
      id.key;
   
   loadData();
}

createId();
         </script>
      </form>

      <h2>Key sort order</h2>
      <p>This shows that earlier created Ids
      have a smaller key. This means they can
      be sorted earliest to latest.</p>
      <pre>
         <script>
var id1 = new Id();
var id2 = new Id();

document.writeln(id1.key < id2.key);
         </script>
      </pre>
    
      <h2>Copying</h2>
      <p>Ids can be copied by passing in
      the source id as the first parameter,
      a key or a timestamp</p>
      <pre>
         <script>

function compareEqual(label, id1, id2)
{
   document.writeln(
      label + ":\t" + (id1.equals(id2))
   );
}

var id3 = new Id(id);

compareEqual("id3", id, id3);

var id4 =
   new Id(
      {
         name: id.name,
         ms: id.ms,
         inc:  id.inc
      }
   );
   
compareEqual("id4", id,  id4);

var id5 = new Id({key: id.key});

compareEqual("id5", id, id5);


         </script>
      </pre>
      
      <h2>Example</h2>
      <p>Here we show how it creates an id
      for any custom class.</p>
      <pre id="example">
         <script>
class A extends Id
{
   constructor(input)
   {
      super(input);
      Object.assign(this, input);
   }

   toJSON() {
      return {
         ms: super.ms,
         inc: super.inc,
         data: this.data
      }
   }

}

var a = new A();

var key = a.key;

document.writeln(
   a.toString()
);


a2 = new A({key});

document.writeln(
   a.equals(a2)
);

         </script>
      </pre>
      
      <h2>Load/Save</h2>
      <p>Here we show how it load and save
      our custom class.</p>
      <pre id="load">
         <script>
var a = new A({data:"Hello World"});

a.save().then(
   id => {
      writeln("load", id);
      return id.load();
   }
)
.then(
   b => writeln(
      "load",
      b.constructor.name  + " says " + b.data
   )
)
.catch(
   error => alert(error.stack)
);
         </script></pre>
   </body>
</html>
